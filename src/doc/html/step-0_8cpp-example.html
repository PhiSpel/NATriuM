<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>NATriuM: step-0.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>step-0.cpp</h1><h2><a class="anchor" id="sec_intro">
Basis tutorial: Lid-driven cavity in 2D</a></h2>
<p>This example is thoroughly commented to introduce you to the key concepts in fluid flow simulations with NATriuM. There are three main classes that are used in a NATriuM simulation:</p>
<ul>
<li>SolverConfiguration: Contains all the simulation preferences.</li>
<li>ProblemDescription: Contains the computation grid, initial conditions and boundary conditions. ProblemDescription is an abstract class with the purely virtual functions applyInitialDensities and applyInitialVelocities. When you use NATriuM as a library, this class has to be overriden by a problem specific child class (here the class LidDrivenCavity2D), which implements the virtual functions.</li>
<li>CFDSolver: The CFDSolver is the central class in the NATriuM framework. It creates all necessary classes and runs the simulation.</li>
</ul>
<p>We have the following includes that are part of every simulation script in NATriuM: First, we need stdlib.h to access the environment variable NATRIUM_HOME and ssteam to concatenate strings to build the path of the output directory. Second, the three classes mentioned above are implemented in <a class="el" href="CFDSolver_8h.html" title="CFD Solver, specified for Benchmark applications.">CFDSolver.h</a>, <a class="el" href="SolverConfiguration_8h.html" title="Calculation of physical properties.">SolverConfiguration.h</a>, and <a class="el" href="ProblemDescription_8h.html" title="Abstract class for the description of a CFD problem. The description includes the...">ProblemDescription.h</a>. Third, <a class="el" href="BasicNames_8h.html" title="Definition of the basic typedefs and names used in the Code;.">BasicNames.h</a> contains some general typedefs used throughout NATriuM and automatically enables using certain std and boost types and functions (e.g. boost::shared_ptr). It has to be included in basically every file that is part of or uses NATriuM. Finally, we include <a class="el" href="LidDrivenCavity2D_8h.html" title="Lid-driven cavity with three static walls and one moving wall.">LidDrivenCavity2D.h</a>. It contains the class LidDrivenCavity2D, which defines the concrete flow we want to simulate.  <a class="el" href="step-0_8cpp.html">step-0.cpp</a> Includes</p>
<p>We include the namespace natrium to access all classes and functions directly.  <a class="el" href="step-0_8cpp.html">step-0.cpp</a> Namespace</p>
<p>The Main function of the program begins with defining the Reynolds and Mach number. Note that in the LBM context the Mach number must not exceed a limit of approximately 0.3. On the other hand the time step is proportional to the Mach number, meaning that for Ma &lt;&lt; 0.1 the runtime of the code will grow. Usually, Ma is set roughly to 0.1. (On the contrary, the Reynolds number does not influence the time step size directly.)  <a class="el" href="step-0_8cpp.html">step-0.cpp</a> Main function</p>
<p>Next, the discretization is defined. As the grid generation in the easier geometries is done inside deal.II, we need to specify the refinement level. Refinement level 4 will mean that our quadratic domain will have 2^4 * 2^4 = 256 cells. See LidDrivenCavity2D::makeGrid() for details on the grid generation. The next thing to specify is the order of the finite element, often referred to as p. p=1 stands for linear shape functions (the finite elments), while greater values of p stand for higher order polynomials. The choice of p has a tremendous impact on the accuracy and runtime of the program. Great values of p can lead to very accurate solutions (sometimes even exponential convergence in space!) but they require tiny timesteps (</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \delta_t \sim \frac{1}{(p+1)^2} \]" src="form_26.png"/>
</p>
<p>). To chose p=5 is often a reasonable compromise. Finally, we have to chose the time step. Small timesteps lead to long simulations, while big timesteps render the simulation unstable. When we use explicit time integration, the suitable time step depends only on the CFL condition. There are functions implemented in NATriuM to automate theses calculations. This is left for later tutorials and we simply set dt=0.0001.  <a class="el" href="step-0_8cpp.html">step-0.cpp</a> Discretization</p>
<p>Now, we have to specify the characteristic velocity and kinematic viscosity of the flow. The setting of the characteristic velocity depends on the fact, that we fix the speed of sound to </p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ c_s = \frac{1}{\sqrt{3}} \]" src="form_27.png"/>
</p>
<p> and normalize the time scale with respect to that speed. This is a standard approach in Lattice Boltzmann. However, NATriuM also provides the possibility to use physical units, which has to do with the scaling of the difference stencil is covered in later tutorials. The viscosity is determined by the Reynolds number, characteristic velocity and characteristic length L = 1.0.  <a class="el" href="step-0_8cpp.html">step-0.cpp</a> Definition</p>
<p>The next step is to create the configuration object and feed it with the information we have just discussed. There are a lot more things to set, but we take the default settings for the rest. The the output frequency and number of time steps are set manually. Additionally, we disable the restart option, which forces the simulation to start at t=0.  <a class="el" href="step-0_8cpp.html">step-0.cpp</a> Configuration</p>
<p>Similarly, we create the flow object. It is inherited of ProblemDescription and needed to be assigned to a boost::shared_ptr&lt;ProblemDescription&gt;.  <a class="el" href="step-0_8cpp.html">step-0.cpp</a> Problem</p>
<p>Finally, we are ready to create the CFD solver and run the simulation.  <a class="el" href="step-0_8cpp.html">step-0.cpp</a> Solver</p>
<dl class="date"><dt><b>Date:</b></dt><dd>31.03.2014 </dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Andreas Kraemer, Bonn-Rhein-Sieg University of Applied Sciences, Sankt Augustin</dd></dl>
<div class="fragment"><pre class="fragment">

<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;sstream&gt;</span>

<span class="preprocessor">#include &quot;<a class="code" href="CFDSolver_8h.html" title="CFD Solver, specified for Benchmark applications.">natrium/solver/CFDSolver.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="SolverConfiguration_8h.html" title="Calculation of physical properties.">natrium/solver/SolverConfiguration.h</a>&quot;</span>

<span class="preprocessor">#include &quot;<a class="code" href="ProblemDescription_8h.html" title="Abstract class for the description of a CFD problem. The description includes the...">natrium/problemdescription/ProblemDescription.h</a>&quot;</span>

<span class="preprocessor">#include &quot;<a class="code" href="BasicNames_8h.html" title="Definition of the basic typedefs and names used in the Code;.">natrium/utilities/BasicNames.h</a>&quot;</span>

<span class="preprocessor">#include &quot;<a class="code" href="LidDrivenCavity2D_8h.html" title="Lid-driven cavity with three static walls and one moving wall.">LidDrivenCavity2D.h</a>&quot;</span>

<span class="keyword">using namespace </span>natrium;



<span class="keywordtype">int</span> <a name="a0"></a><a class="code" href="step-0_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4" title="[Namespace]">main</a>() {
        <span class="comment">// TODO Documentation</span>
        MPIGuard::getInstance();

        <span class="comment">// TODO Documentation</span>
        pout &lt;&lt; <span class="stringliteral">&quot;Starting NATriuM step-0...&quot;</span> &lt;&lt; endl;

        <span class="comment">// set Reynolds and Mach number</span>
        <span class="keyword">const</span> <span class="keywordtype">double</span> Re = 1000;
        <span class="keyword">const</span> <span class="keywordtype">double</span> Ma = 0.1;

        <span class="comment">// set spatial discretization</span>
        <span class="keywordtype">size_t</span> refinementLevel = 4;
        <span class="keywordtype">size_t</span> orderOfFiniteElement = 5;

        <span class="comment">// set temporal discretization</span>
        <span class="keywordtype">double</span> dt = 0.0001;

        <span class="comment">// set Problem so that the right Re and Ma are achieved</span>
        <span class="keyword">const</span> <span class="keywordtype">double</span> U = 1 / sqrt(3) * Ma;
        <span class="keyword">const</span> <span class="keywordtype">double</span> viscosity = U / Re; <span class="comment">// (because L = 1)</span>

        std::stringstream dirname;
        dirname &lt;&lt; getenv(<span class="stringliteral">&quot;NATRIUM_HOME&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;/step-0&quot;</span>;

        boost::shared_ptr&lt;SolverConfiguration&gt; configuration = boost::make_shared&lt;
                        <a name="_a1"></a><a class="code" href="classnatrium_1_1SolverConfiguration.html" title="Class that stores the configuration for a CFD simulation based on the Discrete Boltzmann...">SolverConfiguration</a>&gt;();
        configuration-&gt;setOutputDirectory(dirname.str());
        configuration-&gt;setRestartAtLastCheckpoint(<span class="keyword">false</span>);
        configuration-&gt;setOutputCheckpointInterval(1000);
        configuration-&gt;setOutputSolutionInterval(100);
        configuration-&gt;setSedgOrderOfFiniteElement(orderOfFiniteElement);
        configuration-&gt;setTimeStepSize(dt);
        configuration-&gt;setNumberOfTimeSteps(200000);

        <span class="comment">// make problem and solver objects</span>
        boost::shared_ptr&lt;LidDrivenCavity2D&gt; lidDrivenCavity = boost::make_shared&lt;
                        <a name="_a2"></a><a class="code" href="classnatrium_1_1LidDrivenCavity2D.html" title="Description of a lid-driven cavity flow.">LidDrivenCavity2D</a>&gt;(U, viscosity, refinementLevel);
        boost::shared_ptr&lt;ProblemDescription&lt;2&gt; &gt; ldCavityProblem = lidDrivenCavity;

        <a name="_a3"></a><a class="code" href="classnatrium_1_1CFDSolver.html" title="The central class for the CFD simulation based on the DBE.">CFDSolver&lt;2&gt;</a> solver(configuration, ldCavityProblem);
        solver.<a name="a4"></a><a class="code" href="classnatrium_1_1CFDSolver.html#a11f503bc3f3c306b240874c74a38025b" title="run CFD solver">run</a>();

        pout &lt;&lt; <span class="stringliteral">&quot;NATriuM step-0 terminated.&quot;</span> &lt;&lt; endl;

        <span class="keywordflow">return</span> 0;
}

</pre></div> </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 8 Dec 2015 for NATriuM by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
